<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyClone Prediction Market</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>

    <style>
        :root { --tg-theme-button-color: #2481cc; --tg-theme-text-color: #000; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; margin: 0; padding: 15px; color: var(--tg-theme-text-color); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .wallet-btn { background-color: var(--tg-theme-button-color); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .card { background: white; border-radius: 15px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        .market-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 10px; color: #1a1a1a; }
        .odds-container { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 0.9rem; color: #666; }
        .btn-group { display: flex; gap: 10px; }
        .bet-btn { flex: 1; border: none; padding: 12px; border-radius: 10px; font-weight: bold; font-size: 1rem; cursor: pointer; transition: opacity 0.2s; }
        .btn-yes { background-color: #27ae60; color: white; }
        .btn-no { background-color: #e74c3c; color: white; }
        .bet-btn:active { opacity: 0.7; }
        #status { text-align: center; font-size: 0.8rem; color: #888; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="header">
        <h3>ğŸ”® PolyClone</h3>
        <button id="connectBtn" class="wallet-btn" onclick="connectWallet()">CÃ¼zdan BaÄŸla</button>
    </div>

    <div id="market-list">
        <div class="card">
            <div class="market-title">Bitcoin bu ay sonu 100.000$ barajÄ±nÄ± geÃ§er mi?</div>
            <div class="odds-container">
                <span>ğŸ‘ Evet: %65</span>
                <span>ğŸ‘ HayÄ±r: %35</span>
            </div>
            <div class="btn-group">
                <button class="bet-btn btn-yes" onclick="makeBet(true)">EVET</button>
                <button class="bet-btn btn-no" onclick="makeBet(false)">HAYIR</button>
            </div>
        </div>
    </div>

    <div id="status">CÃ¼zdan baÄŸlÄ± deÄŸil</div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- BURAYI GÃœNCELLE ---
        const contractAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138";
        const contractABI = [[
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_marketId",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "_tahmin",
				"type": "bool"
			}
		],
		"name": "bahisYap",
		"outputs": [],
		"stateMutability": "payable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_marketId",
				"type": "uint256"
			}
		],
		"name": "kazancCek",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_soru",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_sureSaniye",
				"type": "uint256"
			}
		],
		"name": "piyasaOlustur",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_marketId",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "_kazananSonuc",
				"type": "bool"
			}
		],
		"name": "piyasayiBitir",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "admin",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			},
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "bahisler",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "miktar",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "tahmin",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "odendi",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "marketler",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "id",
				"type": "uint256"
			},
			{
				"internalType": "string",
				"name": "soru",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "bitisZamani",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "evetBakiye",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "hayirBakiye",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "sonuclandi",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "sonuc",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "marketSayisi",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]

        ];

        let signer;
        let contract;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const provider = new ethers.providers.Web3Provider(window.ethereum);
                    await provider.send("eth_requestAccounts", []);
                    signer = provider.getSigner();
                    const address = await signer.getAddress();

                    contract = new ethers.Contract(contractAddress, contractABI, signer);

                    document.getElementById('connectBtn').innerText = address.substring(0, 6) + "...";
                    document.getElementById('status').innerText = "CÃ¼zdan BaÄŸlandÄ±: " + address;
                    tg.showAlert("BaÄŸlantÄ± BaÅŸarÄ±lÄ±!");
                } catch (error) {
                    console.error(error);
                    tg.showAlert("BaÄŸlantÄ± hatasÄ± oluÅŸtu.");
                }
            } else {
                tg.showAlert("LÃ¼tfen Metamask veya TrustWallet yÃ¼klÃ¼ bir tarayÄ±cÄ±dan aÃ§Ä±n.");
            }
        }

        async function makeBet(prediction) {
            if (!contract) {
                tg.showAlert("LÃ¼tfen Ã¶nce cÃ¼zdanÄ±nÄ±zÄ± baÄŸlayÄ±n!");
                return;
            }

            try {
                // Bahis miktarÄ± (Ã–rn: 0.01 MATIC)
                const amount = ethers.utils.parseEther("0.01");

                // Remix'teki bahisYap(marketId, tahmin) fonksiyonunu Ã§aÄŸÄ±rÄ±r
                // Not: Market ID'sini ÅŸimdilik 1 olarak sabitledik
                const tx = await contract.bahisYap(1, prediction, { value: amount });

                tg.showConfirm("Ä°ÅŸlem blokzincire gÃ¶nderildi. OnaylanmasÄ±nÄ± bekleyin...");
                await tx.wait();
                tg.showAlert("Ä°ÅŸlem BaÅŸarÄ±lÄ±! Bahsiniz alÄ±ndÄ±.");
            } catch (error) {
                console.error(error);
                tg.showAlert("Ä°ÅŸlem baÅŸarÄ±sÄ±z: " + error.message);
            }
        }
    </script>
</body>
</html>
