<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Gambmon Pro | Tahmin Pazarƒ±</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; text-align: center; padding: 20px; }
        .card { background: #1e293b; border-radius: 15px; padding: 20px; margin: 10px auto; max-width: 400px; border: 1px solid #334155; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-yes { background: #22c55e; color: white; }
        .btn-no { background: #ef4444; color: white; }
        .btn-claim { background: #38bdf8; color: white; width: 100%; margin-top: 10px; }
        .status-tag { font-size: 0.8em; padding: 4px 8px; border-radius: 4px; background: #475569; }
    </style>
</head>
<body>

    <h1>üé≤ GAMBMON PRO</h1>
    <button id="connectBtn" class="btn" style="background:#2563eb; color:white;">C√ºzdanƒ± Baƒüla</button>
    <div id="market-list"></div>

<script>
    const contractAddress = "YENI_KONTRA_ADRESINIZ";
    const abi = [
        "function piyasalar(uint256) view returns (string soru, uint256 evetToplam, uint256 hayirToplam, bool bitti, int8 kazanan)",
        "function piyasaSayisi() view returns (uint256)",
        "function bahisYap(uint256 _id, bool _secim) payable",
        "function odulCek(uint256 _id)"
    ];

    let signer, contract;

    async function connect() {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, abi, signer);
        document.getElementById('connectBtn').innerText = "Baƒülandƒ±";
        loadMarkets();
    }

    async function loadMarkets() {
        const list = document.getElementById('market-list');
        const count = await contract.piyasaSayisi();
        list.innerHTML = "";
        for (let i = 0; i < count; i++) {
            const m = await contract.piyasalar(i);
            const status = m.bitti ? "KAPANDI" : "AKTƒ∞F";
            let actionButtons = `
                <button class="btn btn-yes" onclick="bet(${i}, true)">EVET</button>
                <button class="btn btn-no" onclick="bet(${i}, false)">HAYIR</button>`;
            
            if (m.bitti) {
                actionButtons = `<button class="btn btn-claim" onclick="claim(${i})">üéÅ √ñD√úL√úM√ú √áEK</button>`;
            }

            list.innerHTML += `
                <div class="card">
                    <span class="status-tag">${status}</span>
                    <h3>${m.soru}</h3>
                    <p>Evet: ${ethers.utils.formatEther(m.evetToplam)} POL</p>
                    <p>Hayƒ±r: ${ethers.utils.formatEther(m.hayirToplam)} POL</p>
                    ${actionButtons}
                </div>`;
        }
    }

    async function bet(id, choice) {
        const tx = await contract.bahisYap(id, choice, { value: ethers.utils.parseEther("0.1") });
        await tx.wait();
        loadMarkets();
    }

    async function claim(id) {
        try {
            const tx = await contract.odulCek(id);
            await tx.wait();
            alert("√ñd√ºl ba≈üarƒ±yla √ßekildi!");
            loadMarkets();
        } catch (e) { alert("√áekilecek √∂d√ºl yok veya zaten √ßekildi!"); }
    }

    document.getElementById('connectBtn').onclick = connect;
</script>
</body>
</html>
